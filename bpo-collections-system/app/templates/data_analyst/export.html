{% extends "base.html" %}

{% block title %}Export Data - BPO Collections System{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Export Payment Records</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('data_analyst.generate_export') }}">
            {{ form.hidden_tag() }}
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <h6>Export Type</h6>
                    <div class="form-check">
                        {{ form.export_type(class="form-check-input") }}
                        {{ form.export_type.label(class="form-check-label") }}
                    </div>
                </div>
            </div>
            
            <div id="campaignSection" class="row mb-3">
                <div class="col-md-6">
                    {{ form.campaign.label(class="form-label") }}
                    {{ form.campaign(class="form-select") }}
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    {{ form.start_date.label(class="form-label") }}
                    {{ form.start_date(class="form-control") }}
                </div>
                <div class="col-md-6 mb-3">
                    {{ form.end_date.label(class="form-label") }}
                    {{ form.end_date(class="form-control") }}
                </div>
            </div>
            
            <div class="mb-3">
                {{ form.include_headers(class="form-check-input") }}
                {{ form.include_headers.label(class="form-check-label") }}
            </div>
            
            <div class="mb-3">
                {{ form.submit(class="btn btn-primary") }}
            </div>
        </form>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        <h5 class="mb-0">Export History</h5>
    </div>
    <div class="card-body">
        {% if export_history %}
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Campaign</th>
                        <th>Date Range</th>
                        <th>Records</th>
                        <th>Exported By</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for export in export_history %}
                    <tr>
                        <td>{{ export.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>{{ export.export_type }}</td>
                        <td>{{ export.campaign or 'All' if export.export_type == 'campaign' else 'N/A' }}</td>
                        <td>{{ export.start_date }} to {{ export.end_date }}</td>
                        <td>{{ export.record_count }}</td>
                        <td>{{ export.created_by }}</td>
                        <td>
                            <a href="{{ url_for('data_analyst.download_export', export_id=export.id) }}" class="btn btn-sm btn-primary">
                                <i class="bi bi-download"></i> Download
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">No export history found.</div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const exportTypeRadios = document.querySelectorAll('input[name="export_type"]');
        const campaignSection = document.getElementById('campaignSection');
        
        function toggleCampaignSection() {
            const selectedValue = document.querySelector('input[name="export_type"]:checked').value;
            if (selectedValue === 'campaign') {
                campaignSection.style.display = 'flex';
            } else {
                campaignSection.style.display = 'none';
            }
        }
        
        exportTypeRadios.forEach(radio => {
            radio.addEventListener('change', toggleCampaignSection);
        });
        
        // Initialize on page load
        toggleCampaignSection();
    });
</script>
{% endblock %}